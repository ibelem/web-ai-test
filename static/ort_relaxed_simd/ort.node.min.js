/*!
 * ONNX Runtime Web v1.21.0
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
"use strict";var ft=Object.create;var oe=Object.defineProperty;var dt=Object.getOwnPropertyDescriptor;var pt=Object.getOwnPropertyNames;var mt=Object.getPrototypeOf,gt=Object.prototype.hasOwnProperty;var P=(e,t)=>()=>(e&&(t=e(e=0)),t);var Le=(e,t)=>{for(var n in t)oe(e,n,{get:t[n],enumerable:!0})},ne=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of pt(t))!gt.call(e,r)&&r!==n&&oe(e,r,{get:()=>t[r],enumerable:!(s=dt(t,r))||s.enumerable});return e},W=(e,t,n)=>(ne(e,t,"default"),n&&ne(n,t,"default")),bt=(e,t,n)=>(n=e!=null?ft(mt(e)):{},ne(t||!e||!e.__esModule?oe(n,"default",{value:e,enumerable:!0}):n,e)),Ie=e=>ne(oe({},"__esModule",{value:!0}),e);var D,se=P(()=>{"use strict";D=!!(typeof process<"u"&&process.versions&&process.versions.node)});var j,yt,wt,ht,St,Et,Ot,Ae,ae=P(()=>{"use strict";se();j=D?void 0:typeof document<"u"?document.currentScript?.src:typeof self<"u"?self.location?.href:void 0,yt=D||typeof location>"u"?void 0:location.origin,wt=(e,t)=>{try{let n=t??j;return(n?new URL(e,n):new URL(e)).origin===yt}catch{return!1}},ht=(e,t)=>{let n=t??j;try{return(n?new URL(e,n):new URL(e)).href}catch{return}},St=(e,t)=>`${t??"./"}${e}`,Et=async e=>{let n=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(n)},Ot=async e=>(await import(/*webpackIgnore:true*/e)).default,Ae=async(e,t,n,s)=>{{let r=s?"ort-wasm-relaxedsimd-threaded.mjs":"ort-wasm-simd-threaded.mjs",a=e??ht(r,t),o=!D&&n&&a&&!wt(a,t),i=o?await Et(a):a??St(r,t);return[o?i:void 0,await Ot(i)]}}});var be,ye,ie,Pe,vt,Tt,xt,_e,E,G=P(()=>{"use strict";ae();ye=!1,ie=!1,Pe=!1,vt=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Tt=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},xt=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},_e=async e=>{if(ye)return Promise.resolve();if(ie)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Pe)throw new Error("previous call to 'initializeWebAssembly()' failed.");ie=!0;let t=e.initTimeout,n=e.numThreads,s=e.relaxedSimd;if(!Tt())throw new Error("WebAssembly SIMD is not supported in the current environment.");let r=s&&xt(),a=vt();n>1&&!a&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+n+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=n=1);let o=e.wasmPaths,i=typeof o=="string"?o:void 0,c=o?.mjs,d=c?.href??c,h=o?.wasm,l=h?.href??h,u=e.wasmBinary,[b,I]=await Ae(d,i,n>1,r),f=!1,g=[];if(t>0&&g.push(new Promise(A=>{setTimeout(()=>{f=!0,A()},t)})),g.push(new Promise((A,y)=>{let w={numThreads:n};u?w.wasmBinary=u:(l||i)&&(w.locateFile=(S,_)=>l??(i??_)+S),I(w).then(S=>{ie=!1,ye=!0,be=S,A(),b&&URL.revokeObjectURL(b)},S=>{ie=!1,Pe=!0,y(S)})})),await Promise.race(g),f)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},E=()=>{if(ye&&be)return be;throw new Error("WebAssembly is not initialized yet.")}});var O,q,m,ue=P(()=>{"use strict";G();O=(e,t)=>{let n=E(),s=n.lengthBytesUTF8(e)+1,r=n._malloc(s);return n.stringToUTF8(e,r,s),t.push(r),r},q=(e,t,n,s)=>{if(typeof e=="object"&&e!==null){if(n.has(e))throw new Error("Circular reference in options");n.add(e)}Object.entries(e).forEach(([r,a])=>{let o=t?t+r:r;if(typeof a=="object")q(a,o+".",n,s);else if(typeof a=="string"||typeof a=="number")s(o,a.toString());else if(typeof a=="boolean")s(o,a?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof a}`)})},m=e=>{let t=E(),n=t.stackSave();try{let s=t.PTR_SIZE,r=t.stackAlloc(2*s);t._OrtGetLastError(r,r+s);let a=Number(t.getValue(r,s===4?"i32":"i64")),o=t.getValue(r+s,"*"),i=o?t.UTF8ToString(o):"";throw new Error(`${e} ERROR_CODE: ${a}, ERROR_MESSAGE: ${i}`)}finally{t.stackRestore(n)}}});var ke,Be=P(()=>{"use strict";G();ue();ke=e=>{let t=E(),n=0,s=[],r=e||{};try{if(e?.logSeverityLevel===void 0)r.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if(e?.logVerbosityLevel===void 0)r.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);e?.terminate===void 0&&(r.terminate=!1);let a=0;return e?.tag!==void 0&&(a=O(e.tag,s)),n=t._OrtCreateRunOptions(r.logSeverityLevel,r.logVerbosityLevel,!!r.terminate,a),n===0&&m("Can't create run options."),e?.extra!==void 0&&q(e.extra,"",new WeakSet,(o,i)=>{let c=O(o,s),d=O(i,s);t._OrtAddRunConfigEntry(n,c,d)!==0&&m(`Can't set a run config entry: ${o} - ${i}.`)}),[n,s]}catch(a){throw n!==0&&t._OrtReleaseRunOptions(n),s.forEach(o=>t._free(o)),a}}});var Lt,It,Ct,At,Me,Ue=P(()=>{"use strict";G();ue();Lt=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},It=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},Ct=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(n=>(typeof n=="string"?n:n.name)==="webgpu")&&(e.enableMemPattern=!1)},At=(e,t,n)=>{for(let s of t){let r=typeof s=="string"?s:s.name;switch(r){case"webnn":if(r="WEBNN",typeof s!="string"){let i=s?.deviceType;if(i){let c=O("deviceType",n),d=O(i,n);E()._OrtAddSessionConfigEntry(e,c,d)!==0&&m(`Can't set a session config entry: 'deviceType' - ${i}.`)}}break;case"webgpu":if(r="JS",typeof s!="string"){let o=s;if(o?.preferredLayout){if(o.preferredLayout!=="NCHW"&&o.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${o.preferredLayout}`);let i=O("preferredLayout",n),c=O(o.preferredLayout,n);E()._OrtAddSessionConfigEntry(e,i,c)!==0&&m(`Can't set a session config entry: 'preferredLayout' - ${o.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${r}`)}let a=O(r,n);E()._OrtAppendExecutionProvider(e,a)!==0&&m(`Can't append execution provider: ${r}.`)}},Me=e=>{let t=E(),n=0,s=[],r=e||{};Ct(r);try{let a=Lt(r.graphOptimizationLevel??"all"),o=It(r.executionMode??"sequential"),i=typeof r.logId=="string"?O(r.logId,s):0,c=r.logSeverityLevel??2;if(!Number.isInteger(c)||c<0||c>4)throw new Error(`log serverity level is not valid: ${c}`);let d=r.logVerbosityLevel??0;if(!Number.isInteger(d)||d<0||d>4)throw new Error(`log verbosity level is not valid: ${d}`);let h=typeof r.optimizedModelFilePath=="string"?O(r.optimizedModelFilePath,s):0;if(n=t._OrtCreateSessionOptions(a,!!r.enableCpuMemArena,!!r.enableMemPattern,o,!!r.enableProfiling,0,i,c,d,h),n===0&&m("Can't create session options."),r.executionProviders&&At(n,r.executionProviders,s),r.enableGraphCapture!==void 0){if(typeof r.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${r.enableGraphCapture}`);let l=O("enableGraphCapture",s),u=O(r.enableGraphCapture.toString(),s);t._OrtAddSessionConfigEntry(n,l,u)!==0&&m(`Can't set a session config entry: 'enableGraphCapture' - ${r.enableGraphCapture}.`)}if(r.freeDimensionOverrides)for(let[l,u]of Object.entries(r.freeDimensionOverrides)){if(typeof l!="string")throw new Error(`free dimension override name must be a string: ${l}`);if(typeof u!="number"||!Number.isInteger(u)||u<0)throw new Error(`free dimension override value must be a non-negative integer: ${u}`);let b=O(l,s);t._OrtAddFreeDimensionOverride(n,b,u)!==0&&m(`Can't set a free dimension override: ${l} - ${u}.`)}return r.extra!==void 0&&q(r.extra,"",new WeakSet,(l,u)=>{let b=O(l,s),I=O(u,s);t._OrtAddSessionConfigEntry(n,b,I)!==0&&m(`Can't set a session config entry: ${l} - ${u}.`)}),[n,s]}catch(a){throw n!==0&&t._OrtReleaseSessionOptions(n)!==0&&m("Can't release session options."),s.forEach(o=>t._free(o)),a}}});var J,We,Y,De,Fe,ce,le,Re,we=P(()=>{"use strict";J=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},We=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},Y=(e,t)=>{let n=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],s=typeof t=="number"?t:t.reduce((r,a)=>r*a,1);return n>0?Math.ceil(s*n):void 0},De=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},Fe=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},ce=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",le=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",Re=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}});var X,he=P(()=>{"use strict";se();X=async e=>{if(typeof e=="string")if(D)try{let{readFile:t}=require("node:fs/promises");return new Uint8Array(await t(e))}catch(t){if(t.code==="ERR_FS_FILE_TOO_LARGE"){let{createReadStream:n}=require("node:fs"),s=n(e),r=[];for await(let a of s)r.push(a);return new Uint8Array(Buffer.concat(r))}throw t}else{let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let n=t.headers.get("Content-Length"),s=n?parseInt(n,10):0;if(s<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let r=t.body.getReader(),a;try{a=new ArrayBuffer(s)}catch(i){if(i instanceof RangeError){let c=Math.ceil(s/65536);a=new WebAssembly.Memory({initial:c,maximum:c}).buffer}else throw i}let o=0;for(;;){let{done:i,value:c}=await r.read();if(i)break;let d=c.byteLength;new Uint8Array(a,o,d).set(c),o+=d}return new Uint8Array(a,0,s)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}});var Pt,je,$e,H,_t,Se,ze,Ge,Ne,He,Ve,qe=P(()=>{"use strict";Be();Ue();we();G();ue();he();Pt=(e,t)=>{E()._OrtInit(e,t)!==0&&m("Can't initialize onnxruntime.")},je=async e=>{Pt(e.wasm.numThreads,Fe(e.logLevel))},$e=async(e,t)=>{},H=new Map,_t=e=>{let t=E(),n=t.stackSave();try{let s=t.PTR_SIZE,r=t.stackAlloc(2*s);t._OrtGetInputOutputCount(e,r,r+s)!==0&&m("Can't get session input/output count.");let o=s===4?"i32":"i64";return[Number(t.getValue(r,o)),Number(t.getValue(r+s,o))]}finally{t.stackRestore(n)}},Se=e=>{let t=E(),n=t._malloc(e.byteLength);if(n===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,n),[n,e.byteLength]},ze=async(e,t)=>{let n,s,r=E();Array.isArray(e)?[n,s]=e:e.buffer===r.HEAPU8.buffer?[n,s]=[e.byteOffset,e.byteLength]:[n,s]=Se(e);let a=0,o=0,i=0,c=[],d=[],h=[];try{if([o,c]=Me(t),t?.externalData&&r.mountExternalData){let y=[];for(let w of t.externalData){let S=typeof w=="string"?w:w.path;y.push(X(typeof w=="string"?w:w.data).then(_=>{r.mountExternalData(S,_)}))}await Promise.all(y)}for(let y of t?.executionProviders??[])if((typeof y=="string"?y:y.name)==="webnn"){if(r.shouldTransferToMLTensor=!1,r.currentContext)throw new Error("WebNN execution provider is already set.");if(typeof y!="string"){let S=y,_=S?.context,K=S?.gpuDevice,Q=S?.deviceType,ee=S?.powerPreference;_?r.currentContext=_:K?r.currentContext=await r.jsepCreateMLContext(K):r.currentContext=await r.jsepCreateMLContext({deviceType:Q,powerPreference:ee})}else r.currentContext=await r.jsepCreateMLContext();break}a=await r._OrtCreateSession(n,s,o),a===0&&m("Can't create a session."),r.jsepOnCreateSession?.(),r.currentContext&&(r.jsepRegisterMLContext(a,r.currentContext),r.currentContext=void 0,r.shouldTransferToMLTensor=!0);let[l,u]=_t(a),b=!!t?.enableGraphCapture,I=[],f=[],g=[];for(let y=0;y<l;y++){let w=r._OrtGetInputName(a,y);w===0&&m("Can't get an input name."),d.push(w),I.push(r.UTF8ToString(w))}for(let y=0;y<u;y++){let w=r._OrtGetOutputName(a,y);w===0&&m("Can't get an output name."),h.push(w);let S=r.UTF8ToString(w);f.push(S)}let A=null;return H.set(a,[a,d,h,A,b,!1]),[a,I,f]}catch(l){throw d.forEach(u=>r._OrtFree(u)),h.forEach(u=>r._OrtFree(u)),i!==0&&r._OrtReleaseBinding(i)!==0&&m("Can't release IO binding."),a!==0&&r._OrtReleaseSession(a)!==0&&m("Can't release session."),l}finally{r._free(n),o!==0&&r._OrtReleaseSessionOptions(o)!==0&&m("Can't release session options."),c.forEach(l=>r._free(l)),r.unmountExternalData?.()}},Ge=e=>{let t=E(),n=H.get(e);if(!n)throw new Error(`cannot release session. invalid session id: ${e}`);let[s,r,a,o,i]=n;o&&(i&&t._OrtClearBoundOutputs(o.handle)!==0&&m("Can't clear bound outputs."),t._OrtReleaseBinding(o.handle)!==0&&m("Can't release IO binding.")),t.jsepOnReleaseSession?.(e),r.forEach(c=>t._OrtFree(c)),a.forEach(c=>t._OrtFree(c)),t._OrtReleaseSession(s)!==0&&m("Can't release session."),H.delete(e)},Ne=(e,t,n,s,r,a=!1)=>{if(!e){t.push(0);return}let o=E(),i=o.PTR_SIZE,c=e[0],d=e[1],h=e[3],l,u;if(c==="string"&&(h==="gpu-buffer"||h==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(a&&h!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${r} when enableGraphCapture is true.`);if(h==="gpu-buffer"){let f=e[2].gpuBuffer;u=Y(J(c),d);let g=o.jsepRegisterBuffer;if(!g)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');l=g(s,r,f,u)}else if(h==="ml-tensor"){let f=e[2].mlTensor;u=Y(J(c),d);let g=o.jsepRegisterMLTensor;if(!g)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');l=g(f,J(c),d)}else{let f=e[2];if(Array.isArray(f)){u=i*f.length,l=o._malloc(u),n.push(l);for(let g=0;g<f.length;g++){if(typeof f[g]!="string")throw new TypeError(`tensor data at index ${g} is not a string`);o.setValue(l+g*i,O(f[g],n),"*")}}else u=f.byteLength,l=o._malloc(u),n.push(l),o.HEAPU8.set(new Uint8Array(f.buffer,f.byteOffset,u),l)}let b=o.stackSave(),I=o.stackAlloc(4*d.length);try{d.forEach((g,A)=>o.setValue(I+A*i,g,i===4?"i32":"i64"));let f=o._OrtCreateTensor(J(c),l,u,I,d.length,Re(h));f===0&&m(`Can't create tensor for input/output. session=${s}, index=${r}.`),t.push(f)}finally{o.stackRestore(b)}},He=async(e,t,n,s,r,a)=>{let o=E(),i=o.PTR_SIZE,c=H.get(e);if(!c)throw new Error(`cannot run inference. invalid session id: ${e}`);let d=c[0],h=c[1],l=c[2],u=c[3],b=c[4],I=c[5],f=t.length,g=s.length,A=0,y=[],w=[],S=[],_=[],K=o.stackSave(),Q=o.stackAlloc(f*i),ee=o.stackAlloc(f*i),me=o.stackAlloc(g*i),ve=o.stackAlloc(g*i);try{o.jsepOnRunStart?.(d),[A,y]=ke(a);for(let p=0;p<f;p++)Ne(n[p],w,_,e,t[p],b);for(let p=0;p<g;p++)Ne(r[p],S,_,e,f+s[p],b);for(let p=0;p<f;p++)o.setValue(Q+p*i,w[p],"*"),o.setValue(ee+p*i,h[t[p]],"*");for(let p=0;p<g;p++)o.setValue(me+p*i,S[p],"*"),o.setValue(ve+p*i,l[s[p]],"*");let k;k=await o._OrtRun(d,ee,Q,f,ve,g,me,A),k!==0&&m("failed to call OrtRun().");let $=[];for(let p=0;p<g;p++){let z=Number(o.getValue(me+p*i,"*"));if(z===S[p]){$.push(r[p]);continue}let Te=o.stackSave(),B=o.stackAlloc(4*i),V=!1,x,C=0;try{o._OrtGetTensorData(z,B,B+i,B+2*i,B+3*i)!==0&&m(`Can't access output tensor data on index ${p}.`);let ge=i===4?"i32":"i64",te=Number(o.getValue(B,ge));C=o.getValue(B+i,"*");let xe=o.getValue(B+i*2,"*"),ut=Number(o.getValue(B+i*3,ge)),F=[];for(let L=0;L<ut;L++)F.push(Number(o.getValue(xe+L*i,ge)));o._OrtFree(xe)!==0&&m("Can't free memory for tensor dims.");let R=F.reduce((L,T)=>L*T,1);x=We(te);let re=u?.outputPreferredLocations[s[p]];if(x==="string"){if(re==="gpu-buffer"||re==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let L=[];for(let T=0;T<R;T++){let N=o.getValue(C+T*i,"*"),ct=o.getValue(C+(T+1)*i,"*"),lt=T===R-1?void 0:ct-N;L.push(o.UTF8ToString(N,lt))}$.push([x,F,L,"cpu"])}else if(re==="gpu-buffer"&&R>0){let L=o.jsepGetBuffer;if(!L)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let T=L(C),N=Y(te,R);if(N===void 0||!ce(x))throw new Error(`Unsupported data type: ${x}`);V=!0,$.push([x,F,{gpuBuffer:T,download:o.jsepCreateDownloader(T,N,x),dispose:()=>{o._OrtReleaseTensor(z)!==0&&m("Can't release tensor.")}},"gpu-buffer"])}else if(re==="ml-tensor"&&R>0){let L=o.jsepEnsureTensor;if(!L)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(Y(te,R)===void 0||!le(x))throw new Error(`Unsupported data type: ${x}`);let N=await L(C,te,F,!1);V=!0,$.push([x,F,{mlTensor:N,download:o.jsepCreateMLTensorDownloader(C,x),dispose:()=>{o.jsepReleaseTensorId(C),o._OrtReleaseTensor(z)}},"ml-tensor"])}else{let L=De(x),T=new L(R);new Uint8Array(T.buffer,T.byteOffset,T.byteLength).set(o.HEAPU8.subarray(C,C+T.byteLength)),$.push([x,F,T,"cpu"])}}finally{o.stackRestore(Te),x==="string"&&C&&o._free(C),V||o._OrtReleaseTensor(z)}}return u&&!b&&(o._OrtClearBoundOutputs(u.handle)!==0&&m("Can't clear bound outputs."),H.set(e,[d,h,l,u,b,!1])),$}finally{o.stackRestore(K),w.forEach(k=>o._OrtReleaseTensor(k)),S.forEach(k=>o._OrtReleaseTensor(k)),_.forEach(k=>o._free(k)),A!==0&&o._OrtReleaseRunOptions(A),y.forEach(k=>o._free(k))}},Ve=e=>{let t=E(),n=H.get(e);if(!n)throw new Error("invalid session id");let s=n[0],r=t._OrtEndProfiling(s);r===0&&m("Can't get an profile file name."),t._OrtFree(r)}});var fe,Ee,Je,Ye,Xe,Ze,Ke,Qe,et,tt,rt,Oe=P(()=>{"use strict";fe=require("onnxruntime-common");qe();G();ae();Ee=!1,Je=!1,Ye=!1,Xe=async()=>{if(!Je){if(Ee)throw new Error("multiple calls to 'initWasm()' detected.");if(Ye)throw new Error("previous call to 'initWasm()' failed.");Ee=!0;try{await _e(fe.env.wasm),await je(fe.env),Je=!0}catch(e){throw Ye=!0,e}finally{Ee=!1}}},Ze=async e=>{await $e(fe.env,e)},Ke=async e=>Se(e),Qe=async(e,t)=>ze(e,t),et=async e=>{Ge(e)},tt=async(e,t,n,s,r,a)=>He(e,t,n,s,r,a),rt=async e=>{Ve(e)}});var M,nt,Bt,de,ot=P(()=>{"use strict";M=require("onnxruntime-common");Oe();we();se();he();nt=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},Bt=e=>{switch(e[3]){case"cpu":return new M.Tensor(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!ce(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:n,download:s,dispose:r}=e[2];return M.Tensor.fromGpuBuffer(n,{dataType:t,dims:e[1],download:s,dispose:r})}case"ml-tensor":{let t=e[0];if(!le(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:n,download:s,dispose:r}=e[2];return M.Tensor.fromMLTensor(n,{dataType:t,dims:e[1],download:s,dispose:r})}default:throw new Error(`invalid data location: ${e[3]}`)}},de=class{async fetchModelAndCopyToWasmMemory(t){return Ke(await X(t))}async loadModel(t,n){(0,M.TRACE_FUNC_BEGIN)();let s;typeof t=="string"?D?s=await X(t):s=await this.fetchModelAndCopyToWasmMemory(t):s=t,[this.sessionId,this.inputNames,this.outputNames]=await Qe(s,n),(0,M.TRACE_FUNC_END)()}async dispose(){return et(this.sessionId)}async run(t,n,s){(0,M.TRACE_FUNC_BEGIN)();let r=[],a=[];Object.entries(t).forEach(u=>{let b=u[0],I=u[1],f=this.inputNames.indexOf(b);if(f===-1)throw new Error(`invalid input '${b}'`);r.push(I),a.push(f)});let o=[],i=[];Object.entries(n).forEach(u=>{let b=u[0],I=u[1],f=this.outputNames.indexOf(b);if(f===-1)throw new Error(`invalid output '${b}'`);o.push(I),i.push(f)});let c=r.map((u,b)=>nt(u,()=>`input "${this.inputNames[a[b]]}"`)),d=o.map((u,b)=>u?nt(u,()=>`output "${this.outputNames[i[b]]}"`):null),h=await tt(this.sessionId,a,c,i,d,s),l={};for(let u=0;u<h.length;u++)l[this.outputNames[i[u]]]=o[u]??Bt(h[u]);return(0,M.TRACE_FUNC_END)(),l}startProfiling(){}endProfiling(){rt(this.sessionId)}}});var at={};Le(at,{OnnxruntimeWebAssemblyBackend:()=>pe,initializeFlags:()=>st,wasmBackend:()=>Mt});var v,st,pe,Mt,it=P(()=>{"use strict";v=require("onnxruntime-common");Oe();ot();ae();st=()=>{if((typeof v.env.wasm.initTimeout!="number"||v.env.wasm.initTimeout<0)&&(v.env.wasm.initTimeout=0),v.env.wasm.simd===!1&&console.warn('Deprecated property "env.wasm.simd" is set to false. non-SIMD build is no longer provided, and this setting will be ignored.'),typeof v.env.wasm.relaxedSimd!="boolean"&&(v.env.wasm.relaxedSimd=!1),typeof v.env.wasm.proxy!="boolean"&&(v.env.wasm.proxy=!1),typeof v.env.wasm.trace!="boolean"&&(v.env.wasm.trace=!1),typeof v.env.wasm.numThreads!="number"||!Number.isInteger(v.env.wasm.numThreads)||v.env.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)v.env.wasm.numThreads=1;else{let e=typeof navigator>"u"?require("node:os").cpus().length:navigator.hardwareConcurrency;v.env.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}v.env.wasm.wasmPaths===void 0&&j&&j.indexOf("blob:")!==0&&(v.env.wasm.wasmPaths=j.substring(0,j.lastIndexOf("/")+1))},pe=class{async init(t){st(),await Xe(),await Ze(t)}async createInferenceSessionHandler(t,n){let s=new de;return await s.loadModel(t,n),Promise.resolve(s)}},Mt=new pe});var U={};Le(U,{default:()=>Wt});module.exports=Ie(U);W(U,require("onnxruntime-common"),module.exports);var Ut=bt(require("onnxruntime-common")),Z=require("onnxruntime-common");var Ce="1.21.0";var Wt=Ut;{let e=(it(),Ie(at)).wasmBackend;(0,Z.registerBackend)("cpu",e,10),(0,Z.registerBackend)("wasm",e,10)}Object.defineProperty(Z.env.versions,"web",{value:Ce,enumerable:!0});0&&(module.exports={...require("onnxruntime-common")});
//# sourceMappingURL=ort.node.min.js.map
